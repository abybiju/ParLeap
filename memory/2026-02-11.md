# Daily Log — February 11, 2026

## Session: Bible in Live Setlist + Smart Listen Fixes

### What We Did
- Investigated Bible items not showing in live setlist (showed pre-session, disappeared after Start Session)
- Identified root cause: PostgREST INNER JOIN on `songs()` embed excludes rows where `song_id IS NULL` (Bible items)
- Split backend eventService query into two separate Supabase calls (no more songs embed)
- Fixed Smart Listen gate: no longer requires `BIBLE_SMART_LISTEN_ENABLED` env var — honors client toggle
- Added frontend resilience: SetlistPanel merges missing Bible items from initialSetlist
- Added OperatorHUD local tracking of currentItemIsBible (from clicks, not just backend messages)
- Added temporary debug endpoint `/api/debug/event-items/:eventId`
- All changes pushed to production (CI passed)

### Current Status
- **NOT FULLY WORKING** — user reports Bible still not visible after deploy
- Need to test debug endpoint to isolate whether issue is backend (Supabase query) or frontend (rendering)
- Paused work — will resume in next session

### Key Commits
- `3097cd0` — fix: Bible items excluded by PostgREST INNER JOIN + Smart Listen gate
- `b435214` — chore: add debug endpoint for event_items diagnosis

### Debugging Plan for Next Session
1. User tests: `https://parleapbackend-production.up.railway.app/api/debug/event-items/EVENT_ID`
2. If Bible item appears in JSON → issue is frontend merge/rendering
3. If Bible item missing → issue is Supabase query or data
4. Check browser console for `[SetlistPanel] Merging` and `[EventService] Fetched` logs
5. Try `NOTIFY pgrst, 'reload schema'` in Supabase SQL editor to force PostgREST cache refresh

### Lessons
- PostgREST schema cache can cause INNER JOIN even after `DROP NOT NULL` — always verify with direct queries
- When debugging production, add diagnostic endpoints early rather than guessing
- The `BIBLE_SMART_LISTEN_ENABLED` env var design was wrong (opt-in → should be kill-switch)

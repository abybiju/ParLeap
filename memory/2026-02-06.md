# Daily Memory - February 6, 2026

## Smart Bible Listen Feature Discussion & Documentation

### Feature Design Discussion
User raised concern about STT costs in Bible mode for long sermons (40+ minutes). Discussed solution for cost optimization while maintaining accuracy.

**User's Concern:**
- "I don't want my AI token to get finished by listening to all of his words"
- STT runs continuously in Bible mode, accumulating costs
- Want to only activate STT when Bible-related content detected

**Challenge Identified:**
- Can't detect Bible content without STT running (chicken-and-egg problem)
- Need lightweight way to "wake up" system before activating expensive STT

### Solution: Smart Bible Listen (Two-Stage Hybrid System)

**Stage 1: Local Wake-Word Detection (Zero API Cost)**
- Runs in browser (frontend)
- Pattern matching on audio chunks before sending to backend
- Detects Bible book names, wake phrases ("chapter", "verse", "it is written")
- Maintains 10-second audio ring buffer
- No API cost - runs entirely locally

**Stage 2: Selective STT Window (Controlled Cost)**
- Activates ElevenLabs STT only when wake word detected
- Sends ring buffer (last 10s) + next 30s to STT
- If Bible reference found â†’ keep STT active for follow mode
- If no reference found after 30s â†’ shut STT off

**Cost Savings:**
- 40-minute sermon: 2,400 seconds â†’ ~300 seconds (87-93% reduction)
- Example: 5-10 Bible references Ã— 30s each = 150-300 seconds

### Quote-Only Detection Discussion

**User's Request:**
- Detect verses from quotes only (e.g., "weeping and gnashing of teeth")
- Even when book name not mentioned

**Technical Opinion:**
- Quote-only matching is expensive (requires full-text search across all ~31,000 verses)
- STT must be running to get quote text
- High computational cost (fuzzy matching)

**Decision:**
- Make quote-only matching **opt-in only** (disabled by default)
- Toggle: "Quote Search Mode" in Operator HUD
- Show warning: "Quote search uses more API credits"
- Only search after Bible reference detected (provides context)

### User Preferences Captured

1. **Default Behavior**: Smart Listen ON by default when Bible mode is on
2. **STT Window**: 30 seconds after wake word detected
3. **Quote Matching**: Opt-in only (disabled by default)
4. **Ring Buffer**: 10 seconds of audio context
5. **Cost Indicator**: Show savings in UI ("Saved: X seconds of STT")

### Documentation Created

**Files Created:**
- `SMART_BIBLE_LISTEN.md` - Complete feature specification
  - Problem statement
  - Solution architecture
  - Technical design details
  - Implementation checklist
  - Cost savings analysis
  - Architecture diagrams

**Files Updated:**
- `PROJECT_PLAN.md` - Added Future Features section with Smart Bible Listen
- `NEXT_PHASE_PLAN.md` - Added Phase 8: Smart Bible Listen
- `MEMORY.md` - Added February 6, 2026 entry

### Bible Service Enhancement

**Change Made:**
- Added bidirectional book lookup cache (`byId` map)
- Enables O(1) reverse lookups by book ID
- Previously only had `byName` lookup

**Commit:**
- `ae0d81a` - "feat: add bidirectional book lookup cache in bible service"
- Pushed to production

**Files Modified:**
- `backend/src/services/bibleService.ts`

### Feature Status

- **Status**: ðŸ“‹ Documented (not yet implemented)
- **Priority**: Medium (cost optimization, not critical path)
- **Complexity**: Medium-High (requires frontend + backend coordination)
- **Risk**: Low (can fallback to always-on STT if issues occur)

### Next Steps

- Feature is fully documented and ready for future implementation
- Implementation can begin when prioritized
- See `SMART_BIBLE_LISTEN.md` for complete technical specification

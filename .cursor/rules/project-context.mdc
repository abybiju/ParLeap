---
description: ParLeap project context and memory - current status and architecture
alwaysApply: true
---

# ParLeap Project Context

## Current Status (February 2026)

ParLeap is a **real-time AI-powered presentation orchestration platform** for live events. It automates slide switching by listening to speakers/singers and matching audio to pre-loaded content.

### Production Deployments
- **Frontend**: https://www.parleap.com (Vercel)
- **Backend**: https://parleapbackend-production.up.railway.app (Railway)
- **Database**: Supabase (PostgreSQL)

### Completed Phases
- ✅ Phase 1: Foundation (Monorepo, Next.js 14, Express/TypeScript)
- ✅ Phase 2: Real-Time Engine (WebSocket, Audio Capture, ElevenLabs STT)
- ✅ Phase 3: Predictive Matching (Fuzzy matching, auto-advance)
- ✅ Phase 4: Frontend Features (Songs Library, Operator Console, Event Management)
- ✅ Phase 5: Testing & QA (147 tests, CI/CD pipeline)
- ✅ **Adaptive Live Mode** (Multi-song matching, manual override, auto-follow toggle)

### Testing Infrastructure
- **Backend**: Jest (67 unit + 16 integration tests)
- **Frontend**: Vitest (48 unit tests)
- **E2E**: Playwright (configured)
- **CI/CD**: GitHub Actions (lint, type-check, build)

### Key Architecture Decisions
1. **STT Provider**: ElevenLabs Scribe (realtime streaming)
2. **Matching Algorithm**: `string-similarity` with multi-song support
   - Current song checked first (Priority 1)
   - Other songs only if confidence < 60%
   - 85%+ threshold for auto-switch, 60-85% for suggestions
   - Debouncing: 2 sustained matches + 3s cooldown
3. **WebSocket**: Native `ws` library (NOT Socket.io)
4. **State**: Zustand for frontend, in-memory session state for backend
5. **Audio Format**: PCM for ElevenLabs, WebM Opus for Google
6. **Matching Philosophy**: Single source of truth (backend only, no client-side matching)

### Recent Features

**Smart Bible Listen** (February 11, 2026) — IN PROGRESS
- Smart Listen toggle in operator HUD gates STT for Bible items
- Frontend: audio buffered until wake word or "Listen now" triggers STT window
- Backend: `shouldUseSmartListenGate()` checks `session.smartListenEnabled && currentItemIsBible`
- Kill switch: `BIBLE_SMART_LISTEN_ENABLED=false` to force-disable server-side
- **Known issue**: Bible items still not appearing in live setlist after session starts (fix deployed, needs verification)
- Debug endpoint available: `/api/debug/event-items/:eventId`

**Polymorphic setlist** — Bible items in live setlist
- Backend eventService uses split queries (no songs() embed) to avoid PostgREST INNER JOIN issue
- Frontend SetlistPanel merges missing Bible/Media from initialSetlist
- OperatorHUD tracks currentItemIsBible from local clicks + backend messages

**Landing page** – Scripture section ("And scripture too." with three cards, Bible Verses in marquee) and Live Console showcase (operator screenshot with 3D tilt, hover glow, click-to-open lightbox).

**Adaptive Live Mode** (January 27, 2026)
- Multi-song matching: AI detects when singer jumps to different song
- Debouncing: Requires 2 sustained matches before auto-switch
- Auto-follow toggle: Operator can disable AI and take manual control
- Clickable setlist: Click any song to jump immediately
- Song suggestions: Toast notifications for medium-confidence matches (60-85%)
- Smart optimization: Current song checked first, others only if confidence drops

### Session Summaries Location
Recent work is documented in `.cursor/SESSION_SUMMARY_*.md` files.
- **Latest**: `SESSION_SUMMARY_FEB_11_2026.md` - Bible in live setlist + Smart Listen gate fixes

### Important Files
- `PROJECT_PLAN.md` - Master roadmap
- `TESTING_INFRASTRUCTURE_COMPLETE.md` - Test coverage details
- `.cursorrules` - Full architecture specification
- `CLAWDBOT_INSTRUCTIONS.md` - Operational directives for autonomous AI work (Governor System)

### ClawdBot Governor System
- **Status**: Active (January 26, 2026)
- **File**: `CLAWDBOT_INSTRUCTIONS.md`
- **Purpose**: Safety protocols and operational directives for autonomous AI work
- **Integration**: References SOUL.md, AGENTS.md, .cursorrules, and project documentation

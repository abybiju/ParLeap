---
description: ParLeap project context and memory - current status and architecture
alwaysApply: true
---

# ParLeap Project Context

## Current Status (February 2026)

ParLeap is a **real-time AI-powered presentation orchestration platform** for live events. It automates slide switching by listening to speakers/singers and matching audio to pre-loaded content.

### Production Deployments
- **Frontend**: https://www.parleap.com (Vercel)
- **Backend**: https://parleapbackend-production.up.railway.app (Railway)
- **Database**: Supabase (PostgreSQL)

### Completed Phases
- ✅ Phase 1: Foundation (Monorepo, Next.js 14, Express/TypeScript)
- ✅ Phase 2: Real-Time Engine (WebSocket, Audio Capture, ElevenLabs STT)
- ✅ Phase 3: Predictive Matching (Fuzzy matching, auto-advance)
- ✅ Phase 4: Frontend Features (Songs Library, Operator Console, Event Management)
- ✅ Phase 5: Testing & QA (147 tests, CI/CD pipeline)
- ✅ **Adaptive Live Mode** (Multi-song matching, manual override, auto-follow toggle)

### Testing Infrastructure
- **Backend**: Jest (67 unit + 16 integration tests)
- **Frontend**: Vitest (48 unit tests)
- **E2E**: Playwright (configured)
- **CI/CD**: GitHub Actions (lint, type-check, build)

### Key Architecture Decisions
1. **STT Provider**: ElevenLabs Scribe (realtime streaming)
2. **Matching Algorithm**: `string-similarity` with multi-song support
   - Current song checked first (Priority 1)
   - Other songs only if confidence < 60%
   - 85%+ threshold for auto-switch, 60-85% for suggestions
   - Debouncing: 2 sustained matches + 3s cooldown
3. **WebSocket**: Native `ws` library (NOT Socket.io)
4. **State**: Zustand for frontend, in-memory session state for backend
5. **Audio Format**: PCM for ElevenLabs, WebM Opus for Google
6. **Matching Philosophy**: Single source of truth (backend only, no client-side matching)

### Recent Features

**Grab Text + announcement device upload + canvas eraser** (February 15, 2026)
- Grab Text: Tesseract.js client-side OCR in Announcement tab; pre-fills Exact wording from image (URL or file). Best for straight, Latin text.
- Device upload: Add files as slides → upload to `announcement-assets` on Add to setlist. Migration 014 (RLS); bucket `announcement-assets` create in Dashboard if needed.
- Clean image: react-konva editor with eraser brush (frontend-only); Save exports PNG, uploads, updates slide URL. See `CANVA_GRAB_TEXT_RESEARCH.md`.

**Password reset / Forgot password**
- `/auth/forgot-password`: request reset link; `/auth/reset-password`: set new password from email link
- Login page has "Forgot your password?"; Profile Security has "Reset Password" modal
- Supabase Site URL and Redirect URLs must use production domain (e.g. www.parleap.com) for recovery emails

**Bible semantic (vector) and refinements** (February 13, 2026)
- Semantic (OpenAI embeddings) for Bible only: verse-by-content open, Bible Follow, in-chapter jump by content. Lyrics remain fuzzy.
- Full-Bible open: keyword search on `bible_verses.search_text` then semantic rerank; fallback to 15 verses. Chapter-only refs ("Luke 1" → 1:1), book soundalikes ("roman" → Romans), fuzzy book match (≥ 0.82).
- **STT homophones**: "daniel won" → Daniel 1 via `normalizeReferenceText` (won/one→1, two/too→2, for/four→4, ate/eight→8; "to" not changed for range "1 to 3").
- **Known issues (todo)**: Bible verse **advance** not working reliably; **cross-chapter/cross-book jump** not reliable. See `BIBLE_SEMANTIC_BACKLOG.md` for full backlog.

**Smart Bible Listen** (February 11, 2026) — IN PROGRESS
- Smart Listen toggle in operator HUD gates STT for Bible items
- Frontend: audio buffered until wake word or "Listen now" triggers STT window
- Backend: `shouldUseSmartListenGate()` checks `session.smartListenEnabled && currentItemIsBible`
- Kill switch: `BIBLE_SMART_LISTEN_ENABLED=false` to force-disable server-side
- **Known issue**: Bible items still not appearing in live setlist after session starts (fix deployed, needs verification)
- Debug endpoint available: `/api/debug/event-items/:eventId`

**Polymorphic setlist** — Bible items in live setlist
- Backend eventService uses split queries (no songs() embed) to avoid PostgREST INNER JOIN issue
- Frontend SetlistPanel merges missing Bible/Media from initialSetlist
- OperatorHUD tracks currentItemIsBible from local clicks + backend messages

**Landing page** – Scripture section ("And scripture too." with three cards, Bible Verses in marquee) and Live Console showcase (operator screenshot with 3D tilt, hover glow, click-to-open lightbox).

**Adaptive Live Mode** (January 27, 2026)
- Multi-song matching: AI detects when singer jumps to different song
- Debouncing: Requires 2 sustained matches before auto-switch
- Auto-follow toggle: Operator can disable AI and take manual control
- Clickable setlist: Click any song to jump immediately
- Song suggestions: Toast notifications for medium-confidence matches (60-85%)
- Smart optimization: Current song checked first, others only if confidence drops

### Session Summaries Location
Recent work is documented in `.cursor/SESSION_SUMMARY_*.md` files.
- **Password reset**: `SESSION_SUMMARY_PASSWORD_RESET.md`
- **Bible/Smart Listen**: `SESSION_SUMMARY_FEB_11_2026.md`

### To-Do List (see PROJECT_PLAN.md § To-Do List)
- Brainstorm semantic AI / Hugging Face (open-source embeddings in Node/Edge)
- Work on humming search feature (Hum-to-Search; see `HUM_SEARCH_STATUS.md`)
- Background visuals for projector view (optional image/video/motion layer; see `BACKGROUND_AND_ANNOUNCEMENTS_ROADMAP.md`)
- Announcement slides + Ideogram AI (announcement slide type; prompt → Ideogram API → add to slides; see Ideogram API docs)
- Expand projector font options (e.g. Google Fonts API or other APIs)

### Important Files
- `PROJECT_PLAN.md` - Master roadmap and to-do list
- `CANVA_GRAB_TEXT_RESEARCH.md` - Grab Text research (Canva behavior, build-your-own OCR + eraser)
- `BACKGROUND_AND_ANNOUNCEMENTS_ROADMAP.md` - Background visuals and announcement slides (ProPresenter/ProContent context, ParLeap roadmap)
- `BIBLE_SEMANTIC_BACKLOG.md` - Bible semantic shipped behavior and backlog (cross-chapter jump, latency, open-source semantic brainstorm)
- `HUM_SEARCH_STATUS.md` - Hum-to-Search status and next steps
- `TESTING_INFRASTRUCTURE_COMPLETE.md` - Test coverage details
- `.cursorrules` - Full architecture specification
- `CLAWDBOT_INSTRUCTIONS.md` - Operational directives for autonomous AI work (Governor System)

### ClawdBot Governor System
- **Status**: Active (January 26, 2026)
- **File**: `CLAWDBOT_INSTRUCTIONS.md`
- **Purpose**: Safety protocols and operational directives for autonomous AI work
- **Integration**: References SOUL.md, AGENTS.md, .cursorrules, and project documentation
